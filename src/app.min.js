"use strict";$(document).ready(function(){function t(t){let i=$(":focus").prop("tagName"),e=$(":focus").attr("tabindex"),a=$(":focus").siblings().length;"down"==t&&e<a&&(e++,$(i+"[tabindex="+e+"]").focus()),"up"==t&&e>0&&(e--,$(i+"[tabindex="+e+"]").focus()),"right"==t&&e<a&&(e++,$(i+"[tabindex="+e+"]").focus()),"left"==t&&e>0&&(e--,$(i+"[tabindex="+e+"]").focus())}function i(t){chat_feed.forEach(function(i,e){if(i.chatId==t){let t=moment(i.timestamp).format("DD.MM.YYYY, HH:MM");$("div#chat-messages").append('<div class="message '+i.direction+'"><div class="inner"><div class="text"><div>'+i.text+'</div><div class="date">'+t+"</div></div></div></div>")}})}function e(t){if("show"==t){$("div#chat-messages").empty(),i($(":focus").data("id")),$("div#chat-list").css("display","none"),$("div#chat").css("display","block"),setTabindex("div#chat-messages","div.message"),items=$("div#chat-messages div.message");let t=items.length-1;$(items[t]).focus(),v="chat"}"hidde"==t&&$("div#chat").css("display","none")}function a(){alert(document.activeElement),navigator.mozSetMessageHandler("activity",function(t){var i=t.source;"pick"===i.name&&(picture?t.postResult({type:picture.type,blob:picture}):t.postError("Unable to provide a picture"))})}function s(t){if("show"==t){$("div#chat-list").empty();for(let t=0;t<data_chat_list.length;t++){let i='<li class="user-name flex">'+data_chat_list[t].name+'</li><li class="unread-messages">'+data_chat_list[t].unreadMessageCount+"</li>";$("div#chat-list").append('<ul class="user-item flex justify-content-spacebetween" data-id="'+data_chat_list[t].chatId+'"  >'+i+"</ul>")}$("div#chat-list").css("display","block"),setTabindex("div#chat-list","ul.user-item"),items=$("div#chat-list ul.user-item"),$(items[0]).focus(),v="chat-list"}"hidde"==t&&$("div#chat-list").css("display","none")}function c(t){if("show"==t){$("div#chat div#chat-attachments").css("display","block"),$("div#chat div#chat-attachments div.inner div:first-child").focus(),$("div#chat div#bottom-bar div#button-left").html('<img src="icons/arrow-left.svg"/>'),$("div#chat div#bottom-bar div#button-center").html(""),$("div#chat div#bottom-bar div#button-right").html(""),setTabindex("div#chat-attachments div.inner","div"),items=$("div#chat-attachments div.inner div");let t=items.length-1;$(items[t]).focus(),v="attachment"}"hidde"==t&&($("div#chat div#chat-attachments").css("display","none"),$("div#chat div#chat-input textarea").focus(),$("div#chat div#bottom-bar div#button-left").html('<img src="icons/arrow-left.svg"/>'),$("div#chat div#bottom-bar div#button-center").html('<img src="icons/paperclip.svg"/>'),$("div#chat div#bottom-bar div#button-right").html('<img src="icons/envelope.svg"/>'),v="chat-input")}function d(t){"show"==t&&($("div#chat div#chat-input").css("display","block"),$("div#chat div#chat-input textarea").focus(),$("div#chat div#bottom-bar div#button-left").html('<img src="icons/arrow-left.svg"/>'),$("div#chat div#bottom-bar div#button-center").html('<img src="icons/paperclip.svg"/>'),$("div#chat div#bottom-bar div#button-right").html('<img src="icons/envelope.svg"/>'),v="chat-input"),"hidde"==t&&($("div#chat div#chat-input").css("display","none"),$("div#chat div#bottom-bar div#button-left").html('<img src="icons/arrow-left.svg"/>'),$("div#chat div#bottom-bar div#button-center").html(""),$("div#chat div#bottom-bar div#button-right").html('<img src="icons/edit.svg"/>'),v="chat")}function n(){clearTimeout(r)}function o(i){switch(i.key){case"Enter":if(r=setTimeout(n,1500),"chat-list"==v)return e("show"),!1;if("chat-input"==v)return i.preventDefault(),d("hidde"),c("show"),!1;if("attachment"==v)return i.preventDefault(),a(),!1;break;case"ArrowDown":t("down");break;case"ArrowUp":t("up");break;case"ArrowLeft":t("left");break;case"ArrowRight":t("right");break;case"3":break;case"1":case"SoftLeft":if("chat"==v)return s("show"),e("hidde"),!1;if("chat-input"==v)return d("hidde"),e("show"),!1;if("attachment"==v)return c("hidde"),d("show"),!1;break;case"2":case"SoftRight":if(v="chat-input")return d("show"),!1;break;case"Backspace":i.preventDefault(),(v="chat-list")&&window.close()}}function h(t){switch(t.key){case"Enter":clearTimeout(r)}}let r,v="chat-list";s("show"),document.addEventListener("keydown",o),document.addEventListener("keyup",h)});